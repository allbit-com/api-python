# Allbit Socket.io

Use socket.io client implementations for your platform to connect.
The examples on this page will be based on [socket.io-client](https://github.com/socketio/socket.io-client), the official javascript implementation.

## Client Initialization

The request URL looks like "https://ws.allbit.com/socket/" (on polling transport) or "wss://ws.allbit.com/socket/"(on websocket transport).
The following example shows how to connect and initialize client in javascript.

~~~
const io = require('socket.io-client')
const client = io('https://ws.allbit.com', {
  path: '/socket'
)
~~~

In this case, it is important not to pass something like 'https://ws.allbit.com/socket/' as the first argument of the function.
If you do such thing, the client will keep trying to connect to URL 'https://ws.allbit.com/socket.io/' with namespace called 'socket' which results in connection failure.

## Emitting Events to Server

There are three types of events that client can emit.

### subscribe

Emitting an event of this type makes client start or stop retrieving information regarding specific cryptocurrency markets.

You can make the client start or stop retrieving information by emitting event like following example.
~~~
client.emit('subscribe', {
  e: 'select',
  coin: 'APOT', // The base coin symbol of market you want to retrieve information
  quote: 'ETH' // The quote coin symbol of market you want to retrieve information
}) // If you want to retrieve information from single market.

client.emit('subscribe', {
  e: 'select',  
  pairs: [{
    coin: 'APOT',
    quote: 'ETH'
  }, ...] // Array of objects that contains base and quote information.
}) // If you want to retrieve information from multiple markets.

client.emit('subscribe', {
  e: 'end'
}) // If you want to stop retrieving market information.
~~~

Whenever you emit subscribe event that contains 'start' as the value of key 'e', existing subscriptions will be cancelled and overwritten by new.

### user

Emitting an event of this type makes client start or stop retrieving information regarding specific cryptocurrency wallet.
~~~
client.emit('user', {
  e: 'login',
  api: 'API KEY', // When logging in with open API.
  token: 'ALLBIT SESSION KEY', // When logging in from allbit.com
}) // user authentication

client.emit('user', {
  e: 'wallet',
  id: 9999, // use if you know wallet id
  addr: '0x0123456789abcdef' // use if you know wallet address
}) // selecting wallet after user authentication

client.emit('user', {
  e: 'logout'
}) // If you want to stop retrieving wallet information.
~~~

### buffer
(to be implemented)

## Handling Events Emitted from Server

### coin
Events regarding markets subscribed above are emitted from server in following format.
~~~
[{
  e: 'tx', // transaction occurred in market
  thash: '0x000000' // Hexadecimal format string of transaction hash.
},
{
  e: 'trade', // trade occurred in market
  sell: true/false,
  v: '0.00000000', // Float format string of trade volume
  p: '0.00000000', // Float format string of trade price
  t: 1548313626, // Unix timestamp
  seller: '0x000000', // Hexadecimal format string of seller wallet address.
  buyer: '0x000000', // Hexadecimal format string of buyer wallet address.
  base: 'APOT', // The base coin symbol of market
  quote: 'ETH' // The quote coin symbol of market
},
{
  e: 'order', // order data of selected market
  n: 'APOT', // The base coin symbol of market
  q: 'ETH', // The quote coin symbol of market
  d: {
    buyer: [{
      price: '0.00000000', // Float format string of order price
      amount: '0.00000000', // Integer format string of order amount before decimal processing
      decAmount: '0.00000000', // Float format string of order amount after decimal processing
    }, ...], // order data of buy orders in market
    seller: [{
      price: '0.00000000', // Float format string of order price
      amount: '0.00000000', // Integer format string of order amount before decimal processing
      decAmount: '0.00000000', // Float format string of order amount after decimal processing
    }, ...] // order data of sell orders in market
  }
}]
~~~

### wallet
Events regarding wallet selected above are emitted from server in following format.
~~~
[{
  e: 'txfail', // transaction from your wallet failed
  thash: '0x000000' // Hexadecimal format string of transaction hash.
},
{
  e: 'tx', // transaction from your wallet executed
  thash: '0x000000' // Hexadecimal format string of transaction hash.
},
{
  e: 'trade', // trade occurred in market
  ohash: '0x000000', // Hexadecimal format string of order hash generated by selected wallet.
  seller: true/false,
  maker: true/false,
  v: '0.00000000', // Float format string of trade volume
  p: '0.00000000', // Float format string of trade price
  t: 1548313626, // Unix timestamp
  base: 'APOT', // The base coin symbol of market
  quote: 'ETH' // The quote coin symbol of market
},
{
  e: 'order', //  information of order generated by selected wallet changed in market
  ohash: '0x000000', // Hexadecimal format string of order hash generated by selected wallet.
  sell: true/false,
  v: '0.00000000', // Float format string of initial order volume
  remain: '0.00000000', // Float format string of remaining volume
  p: '0.00000000', // Float format string of order price
  t: 1548313626, // Unix timestamp
  base: 'APOT', // The base coin symbol of market
  quote: 'ETH' // The quote coin symbol of market
  status: 1 // status code of order
  cancel: true/false // Validity of order. true if invalid
},
{
  e: 'balance', // balance of some token in selected wallet changed
  coin: 'APOT', // symbol of which token changed its balance
  v: '0.00000000' // Float format string of current balance of token in selected wallet
},
{
  e: 'withdraw', // withdraw transaction occurred from selected wallet
  coin: 'APOT', // symbol of which token was withdrawn
  a: '0.00000000', // Float format string of withdrawn amount
  fee: '0.00000000' // Float format string of withdrawal fee
},
{
  e: 'deposit', // deposit transaction occurred from selected wallet
  coin: 'APOT', // symbol of which token was deposited
  a: '0.00000000' // Float format string of deposited amount
}]
~~~

### update
Events regarding overall information regarding market and variables are emitted from server in following format.
~~~
[{
  e: 'info', // market information updated
  d: [{
    pid: 999, // The id(primary key) of market
    n: 'APOT', // The base coin symbol of market
    i: 999, // The id(primary key) of base coin of market
    d: 18, // The decimal value of base coin of market
    p: '0.00000000', // Float format string of current market price
    dp: '0.00000000', // Float format string of market price of yesterday
    b: '0.00000000', // Float format string of total volume of base token trade in 24 hours
    q: '0.00000000', // Float format string of total volume of quote token trade in 24 hours
    l: '0.00000000', // Float format string of lowest market price of today
    h: '0.00000000' // Float format string of highest market price of today
  }, ...]
},
{
  e: 'price', // deprecated, information only for older version
  eth_usd: '289.90924856',
  gas_price: '46.00000000'
}]
~~~
